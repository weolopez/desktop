<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Integration Test: Preference Persistence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <script type="module">
    import StorageService from '../../src/services/storage-service.js';
    window.StorageService = StorageService;
    // Integration test for preference persistence across sessions
    // Simulate close/reopen by setting preferences, then checking in 'new session'

    (async () => {
      if (typeof StorageService === 'undefined') {
        console.error('StorageService not loaded');
        return;
      }

      const storage = new StorageService();
      await storage.openDB();

      try {
        // Set preferences
        await storage.setItem('wallpaperUrl', 'test-wallpaper.jpg', 'preferences');
        await storage.setItem('dockPosition', 'bottom', 'preferences');

        // Simulate session close - in real test, reload page or use localStorage/sessionStorage to simulate
        // For this test, assume we 'close' by not doing anything, then 'reopen' by getting

        // 'Reopen' - get preferences
        const wallpaper = await storage.getItem('wallpaperUrl', 'preferences');
        const dock = await storage.getItem('dockPosition', 'preferences');

        if (wallpaper !== 'test-wallpaper.jpg' || dock !== 'bottom') {
          throw new Error('Preferences not persisted: wallpaper=' + wallpaper + ', dock=' + dock);
        }

        console.log('Integration test passed: Preferences persist across sessions');
      } catch (error) {
        console.error('Integration test failed:', error.message);
        // This should fail initially as methods not fully implemented
      }
    })();
  </script>
</body>
</html>